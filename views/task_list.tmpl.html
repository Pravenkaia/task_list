
{# set aliases to variables #}

{% set limit = data.limit %}
{% set offset = data.tasks.pagination.n %}
{% set pagination = [data.tasks.pagination.order_by, data.tasks.pagination.direction]|join('/') %}


<div class="d-flex flex-wrap justify-content-center"><h1>{{ data.h1 }}</h1></div>

<div class="d-flex flex-wrap justify-content-center">



    <!-- author sort -->
    <div class="d-flex flex-row center btn btn-secondary m-2">
        <div class="btn-sort">
            <a class="btn-secondary" href="/index/index{{ [page, 'author', 'ask', 0]|join('/') }}">
                <ion-icon name="arrow-up"></ion-icon>
            </a>
        </div>
        <div class="btn-sort">
            <span>Name</span>
        </div>
        <div class="btn-sort">
            <a class="btn-secondary" href="/index/index{{ [page, 'author', 'desk', 0]|join('/') }}">
                <ion-icon name="arrow-down"></ion-icon>
            </a>
        </div>
    </div>
    <!-- end of name sort -->

    <!-- email sort -->
    <div class="d-flex flex-row center btn btn-secondary m-2">
        <div class="btn-sort">
            <a class="btn-secondary" href="/index/index{{ [page, 'email', 'ask', 0]|join('/') }}">
                <ion-icon name="arrow-up"></ion-icon>
            </a>
        </div>
        <div class="btn-sort">
            <span>Email</span>
        </div>
        <div class="btn-sort">
            <a class="btn-secondary" href="/index/index{{ [page, 'email', 'desk', 0]|join('/') }}">
                <ion-icon name="arrow-down"></ion-icon>
            </a>
        </div>
    </div>
    <!-- end of email sort -->

    <!-- status sort -->
    <div class="d-flex flex-row center btn btn-secondary m-2">
        <div class="btn-sort">
            <a class="btn-secondary" href="/index/index{{ [page, 'status', 'ask', offset]|join('/') }}">
                <ion-icon name="arrow-up"></ion-icon>
            </a>
        </div>
        <div class="btn-sort">
            <span>Status</span>
        </div>
        <div class="btn-sort">
            <a class="btn-secondary" href="/index/index{{ [page, 'status', 'desk', offset]|join('/') }}">
                <ion-icon name="arrow-down"></ion-icon>
            </a>
        </div>
    </div>
    <!-- end of status sort -->

</div>



<!-- Pagination -->

<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
        {% for i in 1..data.tasks.pagination.count_pages %}
            {% if i == offset/3+1 %}
                {% set active_class = 'active' %}
            {% else %}
                {% set active_class = '' %}
            {% endif %}
        <li class="page-item {{ active_class }}"><a class="page-link"
                                                    href="/index/index/{{ pagination }}/{{ limit*(i - 1) }}">{{ i }}</a>
        </li>
        {% endfor %}
    </ul>
</nav>
<!-- end of Pagination -->


<!-- Task list -->
<div class="d-flex flex-wrap justify-content-center align-items-stretch">

    {% for task in data.tasks.bd %}
    
    <div class="card mw-90 m-3 cards-width">
        <div class="card-body">
            <h5 class="card-title">{{task.author }}</h5>
            <h6 class="card-subtitle mb-2 text-muted">{{ task.email }}</h6>
            <p class="d-block">ID {{ task.id_task }}</p>
            <p class="card-text">{{ task.task|nl2br }}</p>
            
            <div class="d-flex align-content-start flex-wrap">
                {% if task.status > 0 %}
                <div class="icon-cards mx-auto" title="Done">
                    <ion-icon name="checkmark-circle"></ion-icon>
                </div>
                {% endif %}
                {% if task.redacted > 0 %}
                <div class="icon-cards mx-auto" title="Redacted">
                    <ion-icon name="contact"></ion-icon>
                </div>
                {% endif %}
                {% if session.admin_can_do_it == 'yes' %}
                <div class="icon-cards mx-auto"  title="Go to redact"><a href="/index/redact/{{ task.id_task }}" class="card-link">
                    <ion-icon name="construct"></ion-icon>
                </a></div>
                {% endif %}
            </div>
        </div>
    </div>

    {% endfor %}

</div>
<!-- end of Task list -->



